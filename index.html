<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Monitoring Kesehatan</title>
</head>
<body>
  <h1>Monitoring HR dan RR</h1>
  <p>HR: <span id="hr">--</span></p>
  <p>RR: <span id="rr">--</span></p>
  <p>Status: <span id="kondisi">--</span></p>

  <!-- Load library MQTT dulu -->
  <script src="https://cdn.jsdelivr.net/npm/paho-mqtt@1.1.0/paho-mqtt-min.js"></script>

  <!-- Script JS kamu -->
  <script>
    const hrEl = document.getElementById("hr");
    const rrEl = document.getElementById("rr");
    const kondisiEl = document.getElementById("kondisi");

    const client = new Paho.MQTT.Client("broker.hivemq.com", 8000, "client-" + Math.random());

    client.onConnectionLost = (response) => {
      console.error("Koneksi terputus:", response.errorMessage);
    };

    client.onMessageArrived = (message) => {
      try {
        const data = JSON.parse(message.payloadString);
        hrEl.textContent = data.hr + " bpm";
        rrEl.textContent = data.rr + " bpm";
        kondisiEl.textContent = data.status;
      } catch (e) {
        console.error("Data tidak valid:", e);
      }
    };

    client.connect({
      onSuccess: () => {
        console.log("Tersambung ke MQTT");
        client.subscribe("LAJUPERNAPASANDETAKJANTUNG");
      },
      onFailure: (err) => {
        console.error("Gagal koneksi MQTT:", err);
      }
    });
  </script>
</body>
</html>
